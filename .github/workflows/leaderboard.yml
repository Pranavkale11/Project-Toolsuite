name: Update Leaderboard

on:
  schedule:
    - cron: "0 0 * * *"   # runs daily
  workflow_dispatch:     # allows manual run

jobs:
  leaderboard:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Generate leaderboard
        uses: actions/github-script@v7
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;

            const contributors = await github.paginate(
              github.rest.repos.listContributors,
              { owner, repo }
            );

            let rows = contributors.map((c, i) => {
              const points = c.contributions; // 1 commit = 1 point (for now)
              return `| ${i + 1} | @${c.login} | ${points} | ${c.contributions} |`;
            });

            const content = `
# ðŸ† Project Toolsuite Leaderboard

> Automatically updated based on **public commits** to this repository.

| Rank | Contributor | Points | Commits |
|-----:|------------|-------:|--------:|
${rows.join("\n")}

_Last updated: ${new Date().toUTCString()}_
`;

            require("fs").writeFileSync("LEADERBOARD.md", content.trim());

      - name: Commit leaderboard
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add LEADERBOARD.md
          git commit -m "chore: update leaderboard" || echo "No changes"
          git push
